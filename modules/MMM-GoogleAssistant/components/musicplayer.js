class Music{constructor(e,t,n){this.config=e,this.debug=n,this.MusicStatus=t.MusicStatus,this.currentPlayback=null,this.connected=!1,this.timer=null,console.log("[GA:EXT] Music Player Loaded")}prepare(){var e=document.createElement("div");e.id="EXT_MUSIC",e.className="inactive animate__animated",e.style.setProperty("--animate-duration","1s"),e.appendChild(this.getHTMLElementWithID("div","EXT_MUSIC_BACKGROUND"));const t=this.getHTMLElementWithID("img","EXT_MUSIC_COVER_IMAGE");t.className="fade-in";const n=this.getHTMLElementWithID("div","EXT_MUSIC_COVER");n.appendChild(t);const s=this.getHTMLElementWithID("div","EXT_MUSIC_MISC");s.appendChild(this.getInfoContainer()),s.appendChild(this.getVolumeContainer()),s.appendChild(this.getProgressContainer()),s.appendChild(this.getMusicLogoContainer());const i=this.getHTMLElementWithID("div","EXT_MUSIC_FOREGROUND");return i.appendChild(n),i.appendChild(s),e.appendChild(i),e}getHTMLElementWithID(e,t){const n=document.createElement(e);return n.id=t,n}getInfoContainer(){const e=this.getHTMLElementWithID("div","EXT_MUSIC_INFO"),t={EXT_MUSIC_TITLE:"Title",EXT_MUSIC_ARTIST:"Artist",EXT_MUSIC_ALBUM:"OUT"};for(const[n,s]of Object.entries(t)){const t=this.getHTMLElementWithID("div",n);t.appendChild(this.getIconContainer(this.getFAIconClass(s))),t.appendChild(this.getEmptyTextHTMLElement()),e.appendChild(t)}return e.appendChild(this.getDeviceContainer()),e}getIconContainer(e,t,n){const s=document.createElement("i");return s.className=e,s.dataset.inline="false",s.id=t,s.dataset.icon=n,s}getFAIcon(e){switch(e){case"MUSICPLAYER":return"fab fa-google";case"USB":return"fa fa-usb";case"OUT":return"fas fa-sign-out-alt";case"FOLDER":return"far fa-folder-open";case"Title":return"fa fa-music fa-sm";case"Artist":return"fa fa-user fa-sm";case"Album":return"fa fa-folder fa-sm";case"VOL_HIGH":return"mdi mdi-volume-high";case"VOL_MID":return"mdi mdi-volume-medium";case"VOL_LOW":return"mdi mdi-volume-low";case"VOL_OFF":return"mdi mdi-volume-off";default:return"fa fa-headphones fa-sm"}}getFAIconClass(e){return"infoicon "+this.getFAIcon(e)}getEmptyTextHTMLElement(){const e=document.createElement("span");return e.className="text",e.textContent="",e}getDeviceContainer(){const e=this.getHTMLElementWithID("div","EXT_MUSIC_DEVICE");return e.appendChild(this.getIconContainer(this.getFAIconClass(this.config.useUSB?"USB":"FOLDER"),"EXT_MUSIC_DEVICE_ICON")),e.appendChild(this.getEmptyTextHTMLElement()),e}getVolumeContainer(){const e=this.getHTMLElementWithID("div","EXT_MUSIC_VOLUME");return e.appendChild(this.getIconContainer(this.getFAIconClass("VOL_OFF"),"EXT_MUSIC_VOLUME_ICON")),e.appendChild(this.getEmptyTextHTMLElement()),e}getProgressContainer(){const e=this.getHTMLElementWithID("div","EXT_MUSIC_PROGRESS"),t=this.getHTMLElementWithID("progress","EXT_MUSIC_PROGRESS_BAR");return t.value=0,t.max=100,e.appendChild(t),e}getMusicLogoContainer(){const e=this.getHTMLElementWithID("div","EXT_MUSIC_LOGO"),t=document.createElement("span");return t.className="text",t.textContent="Google Assistant Music Player",e.appendChild(t),e}updateSongInfo(e){if(!e)return;const t=document.getElementById("EXT_MUSIC");if(!e.connected)return void(this.connected&&(this.debug&&console.log("[MUSIC] Disconnected"),this.connected=!1,t.classList.remove("animate__flipInX"),t.classList.add("animate__flipOutX"),t.addEventListener("animationend",(e=>{"flipOutX"==e.animationName&&"EXT_MUSIC"==e.path[0].id&&t.classList.add("inactive"),e.stopPropagation()}),{once:!0})));t.classList.remove("inactive"),this.connected||(this.debug&&console.log("[MUSIC] Connected"),this.connected=!0,t.classList.remove("animate__flipOutX"),t.classList.add("animate__flipInX"));const n=document.getElementById("EXT_MUSIC_COVER_IMAGE");var s;if(s=e.cover?"/modules/MMM-GoogleAssistant/tmp/Music/"+e.cover+"?seed="+e.seed:"/modules/MMM-GoogleAssistant/resources/music.jpg?seed="+e.seed,-1==n.src.indexOf(s)){const e=document.getElementById("EXT_MUSIC_BACKGROUND");e.classList.remove("fade-in");n.offsetWidth;e.classList.add("fade-in"),e.style.backgroundImage=`url(${s})`,n.classList.remove("fade-in");n.offsetWidth;n.classList.add("fade-in"),n.src=s}document.querySelector("#EXT_MUSIC_TITLE .text").textContent=e.title;document.querySelector("#EXT_MUSIC_ALBUM .text").textContent=e.date;const i=document.querySelector("#EXT_MUSIC_ARTIST .text");let a=e.artist;i.textContent=a;document.getElementById("EXT_MUSIC_DEVICE_ICON").className=this.getDeviceIconClass(e.device);document.querySelector("#EXT_MUSIC_DEVICE .text").textContent=e.format+(this.debug?" ("+(e.id+1)+"/"+(e.idMax+1)+")":""),this.updateVolume(e.volume),this.updateProgress(e.current,e.duration)}updateVolume(e){const t=document.querySelector("#EXT_MUSIC_VOLUME .text"),n=document.getElementById("EXT_MUSIC_VOLUME_ICON");t.textContent=e.toFixed(0)+"%",n.className=this.getVolumeIconClass(e.toFixed(0))}getVolumeIconClass(e){let t="VOL_OFF";return 0===e||(t=e<40?"VOL_LOW":e>70?"VOL_HIGH":"VOL_MID"),this.getFAIconClass(t)}getDeviceIconClass(e){return"USB"==e?this.getFAIconClass("USB"):this.getFAIconClass("FOLDER")}updateProgress(e,t){const n=document.getElementById("EXT_MUSIC_PROGRESS_BAR");n.value=e,n.max!=t&&(n.max=t)}setPause(){document.getElementById("EXT_MUSIC").classList.add("pausing")}setPlay(){document.getElementById("EXT_MUSIC").classList.remove("pausing")}}